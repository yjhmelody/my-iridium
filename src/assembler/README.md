# 汇编器

## 具体格式

[label] opcode [operand1 [operand2 [operand3]]]

说明：
- label 可选，声明格式为 `name:`，使用格式为 `@name`, 可以作为操作数使用
- opcode 可选，后面跟0-3个操作数或label
- 操作数分为 源操作数，目的操作数。通常源操作数在前，目的操作数在后
- directives，即指示，控制汇编器做一定的事情，格式为`.name ...`

### 举例

- load $1 #100
- add $1 $2 $1
- label1: add $1 $2 $3

## 编译过程

1. 将字符串传入到解析器
    - assemble 函数接受原始字符串引用
    - Assembler 传递字符串到 `program` 解析器
    - 检查解析是否正确
    - 如果解析成功，把它传递给汇编的每一个阶段(two pass)
    - 每个阶段完成不同功能，以保持整体简洁
    - 第一阶段抽象所有的`label`，构建相应的符号表
    - 第二阶段根据符号表替换符合并编译成二进制码
2. 构造符号表
3. 输出可以被VM运行的Vec<u8>格式的字节码
 
## 验证首部

首部 4 bytes 为 45, 50, 49, 45，接下来 60 bytes 保留。